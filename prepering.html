<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Prepering Lesson - Nightfall Team</title>
<style>
body{margin:0; font-family:Consolas,monospace; background:#050505; color:#fff;}
video, canvas{border:1px solid #333; display:block; margin:10px auto;}
button{margin:5px; padding:10px 20px; background:#0d0d0d; color:#fff; border:1px solid #444; cursor:pointer;}
button:hover{background:#1a1a1a;}
#tools{display:flex; justify-content:center; flex-wrap:wrap;}
</style>
</head>
<body>

<h2 style="text-align:center;">Prepering Lesson</h2>

<div id="tools">
  <div>
    <h3>Kamera Video</h3>
    <video id="cameraVideo" autoplay playsinline width="320" height="240"></video><br>
    <button id="startCam">Start</button>
    <button id="stopCam">Stop & Download</button>
  </div>

  <div>
    <h3>Screen Video</h3>
    <video id="screenVideo" autoplay playsinline width="320" height="240"></video><br>
    <button id="startScreen">Start Screen</button>
    <button id="stopScreen">Stop & Download</button>
  </div>
</div>

<h3 style="text-align:center;">Background Chizish</h3>
<canvas id="drawCanvas" width="600" height="400" style="display:block; margin:auto; background:#111;"></canvas>
<button id="clearCanvas">Clear Canvas</button>

<script>
// ===== CAMERA =====
let camStream, camRecorder, camChunks = [];
const camVideo = document.getElementById('cameraVideo');

document.getElementById('startCam').onclick = async () => {
  camStream = await navigator.mediaDevices.getUserMedia({ video:true, audio:true });
  camVideo.srcObject = camStream;
  camRecorder = new MediaRecorder(camStream);
  camChunks = [];
  camRecorder.ondataavailable = e => camChunks.push(e.data);
  camRecorder.start();
};

document.getElementById('stopCam').onclick = () => {
  camRecorder.stop();
  camRecorder.onstop = () => {
    const blob = new Blob(camChunks, {type:'video/webm'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'camera_video.webm';
    a.click();
    camStream.getTracks().forEach(track => track.stop());
  }
};

// ===== SCREEN =====
let screenStream, screenRecorder, screenChunks = [];
const screenVideo = document.getElementById('screenVideo');

document.getElementById('startScreen').onclick = async () => {
  screenStream = await navigator.mediaDevices.getDisplayMedia({ video:true, audio:true });
  screenVideo.srcObject = screenStream;
  screenRecorder = new MediaRecorder(screenStream);
  screenChunks = [];
  screenRecorder.ondataavailable = e => screenChunks.push(e.data);
  screenRecorder.start();
};

document.getElementById('stopScreen').onclick = () => {
  screenRecorder.stop();
  screenRecorder.onstop = () => {
    const blob = new Blob(screenChunks, {type:'video/webm'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'screen_video.webm';
    a.click();
    screenStream.getTracks().forEach(track => track.stop());
  }
};

// ===== CANVAS DRAW =====
const canvas = document.getElementById('drawCanvas');
const ctx = canvas.getContext('2d');
let drawing = false;

canvas.onmousedown = () => drawing = true;
canvas.onmouseup = () => drawing = false;
canvas.onmousemove = e => {
  if(!drawing) return;
  ctx.fillStyle = 'white';
  ctx.fillRect(e.offsetX, e.offsetY, 4, 4);
};

document.getElementById('clearCanvas').onclick = () => {
  ctx.clearRect(0,0,canvas.width,canvas.height);
};
</script>

</body>
</html>
